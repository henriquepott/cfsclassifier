---
title: "Introduction to cfsclassifier: Algorithmic Scoring of the Clinical Frailty Scale"
author: "Henrique Pott"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to cfsclassifier: Algorithmic Scoring of the Clinical Frailty Scale}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


### Abstract
The cfsclassifier package provides a standardized computational framework for operationalizing the Clinical Frailty Scale (CFS). By implementing established classification rules, this tool enables researchers to transform multidimensional health data—including Activities of Daily Living (ADLs), comorbidities, and self-rated health—into validated frailty scores (1–9).

### Clinical Background
The Clinical Frailty Scale is a highly validated instrument used to assess the vulnerability of older adults. While traditionally scored through clinical judgment, algorithmic classification ensures reproducibility in large-scale epidemiological datasets. This package implements the hierarchical logic required to distinguish between fitness, mild vulnerability, and advanced frailty levels.

### Getting Started
#### 1. Dataset Preparation
To demonstrate the classification flow, we will use a synthetic dataset with non-standard column names, simulating a real-world research scenario.

```{r}
library(cfsclassifier)
library(dplyr)

# Simulated cohort data
research_data <- data.frame(
  subject_id = 1:3,
  # BALDS (0: No difficulty, 1: Difficulty)
  dress_dep = c(0, 0, 1), 
  walk_dep  = c(0, 1, 1),
  # IALDS (0: No difficulty, 1: Difficulty)
  phone_dep = c(0, 1, 1),
  shop_dep  = c(0, 1, 1),
  # Health indicators
  self_health = c(1, 3, 5), # 1: Very good, 5: Very bad
  daily_effort = c(1, 4, 5), # 1: Rarely, 5: Always
  phys_act     = c(1, 3, 4), # 1: Active, 4: Sedentary
  term_illness = c(0, 0, 0)  # 0: No, 1: Yes
)
```

#### 2. Variable Mapping
The classify_cfs() function requires a mapping list to link your dataset's columns to the standard variables expected by the CFS algorithm.

```{r}
# Define the mapping between standard variables and local columns
cfs_map <- list(
  bald_dressing = "dress_dep",
  bald_walking  = "walk_dep",
  iald_phone_use = "phone_dep",
  iald_shopping  = "shop_dep",
  general_health = "self_health",
  daily_effort   = "daily_effort",
  physical_activity = "phys_act",
  terminally_ill = "term_illness"
)

# Execute classification
classified_df <- classify_cfs(research_data, variable_map = cfs_map)
```

#### 3. Data Interpretation and Grouping
A key feature of version 0.1.1 is the inclusion of analytical grouping schemes. These allow for pragmatic aggregation of the 9-point scale into categories commonly used in clinical research.

```{r}
# Apply descriptive labels and grouping schemes
final_analysis <- classified_df %>%
  mutate(
    Description = cfs_label(cfs_score),
    Group_Binary = cfs_group(cfs_score, scheme = "2group"),
    Group_Clinical = cfs_group(cfs_score, scheme = "4group")
  )

# Reviewing classification results
final_analysis %>%
  select(subject_id, cfs_score, Description, Group_Clinical) %>%
  knitr::kable()
```

### Analytical Grouping Schemes
The package supports two primary grouping strategies: (1) Two-group scheme: Non-frail (CFS 1–4) vs. Frail (CFS 5–9). (2) Four-group scheme: Fit (CFS 1–3), Very mild frailty (CFS 4), Mild frailty (CFS 5), and Moderate-to-severe frailty (CFS 6–9).

### Validation
To ensure the internal consistency of the classification logic, use the validate_cfs() function. This tool cross-references calculated counts (ADLs/comorbidities) against the assigned CFS score to flag potential mapping errors.

```{r}
validation <- validate_cfs(final_analysis, variable_map = cfs_map)
summary(validation$check_pass)
```

---
### References
* Theou O, Pérez-Zepeda MU, van der Valk AM, Searle SD, Howlett SE, Rockwood K. A classification tree to assist with routine scoring of the Clinical Frailty Scale. Age Ageing. 2021 Jun 28;50(4):1406-1411. doi: 10.1093/ageing/afab006. PMID: 33605412; PMCID: PMC7929455.
* Rockwood K, Theou O. Using the Clinical Frailty Scale in Allocating Scarce Health Care Resources. Can Geriatr J. 2020 Sep 1;23(3):210-215. doi: 10.5770/cgj.23.463. PMID: 32904824; PMCID: PMC7458601.
* More information on the Clinical Frailty Scale can be found at: [https://academic.oup.com/ageing/article/50/4/1406/6144822](https://academic.oup.com/ageing/article/50/4/1406/6144822) and [https://cgjonline.ca/index.php/cgj/article/view/463](https://cgjonline.ca/index.php/cgj/article/view/463)
